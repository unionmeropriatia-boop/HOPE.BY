<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Упрощённая заявка — быстрый бриф</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
    form { max-width: 720px; margin: 0 auto; display: grid; gap: 12px; }
    label { display: grid; gap: 6px; }
    input, textarea, select, button { padding: 10px; font-size: 16px; }
    button { cursor: pointer; }
    .status { max-width: 720px; margin: 16px auto; }
    .error { color: #b00020; }
    .success { color: #0b8043; }
  </style>
</head>
<body>
  <h1>Упрощённая заявка — быстрый бриф</h1>

  <form id="briefForm">
    <label>
      Название мероприятия
      <input type="text" name="title" required />
    </label>
    <label>
      Дата/время
      <input type="text" name="datetime" placeholder="например: 25.12.2025, 19:00" required />
    </label>
    <label>
      Место проведения
      <input type="text" name="place" required />
    </label>
    <label>
      Организатор
      <input type="text" name="organizer" required />
    </label>
    <label>
      Контакты (телефон/почта)
      <input type="text" name="contacts" required />
    </label>
    <label>
      Краткое описание
      <textarea name="description" rows="4" required></textarea>
    </label>
    <button type="submit">Отправить</button>
  </form>

  <div class="status" id="status"></div>

  <script>
    // Если открываете через FastAPI StaticFiles, можно использовать относительный URL:
    const BASE_API_URL = "";

    const form = document.getElementById("briefForm");
    const statusEl = document.getElementById("status");

    function setStatus(html, cls = "") {
      statusEl.className = cls;
      statusEl.innerHTML = html;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      setStatus("Отправка...", "");

      const formData = new FormData(form);
      const payload = {
        title: formData.get("title")?.trim(),
        datetime: formData.get("datetime")?.trim(),
        place: formData.get("place")?.trim(),
        organizer: formData.get("organizer")?.trim(),
        contacts: formData.get("contacts")?.trim(),
        description: formData.get("description")?.trim(),
      };

      for (const [k, v] of Object.entries(payload)) {
        if (!v) {
          setStatus(`Поле "${k}" не заполнено.`, "error");
          return;
        }
      }

      try {
        const resp = await fetch(`${BASE_API_URL}/briefs/json`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!resp.ok) {
          const text = await resp.text();
          throw new Error(`Ошибка API: ${resp.status} ${text}`);
        }

        const data = await resp.json();
        setStatus(
          `Заявка отправлена. Диапазон: ${data.updatedRange || "добавлено"}`,
          "success"
        );
        form.reset();
      } catch (err) {
        console.error(err);
        setStatus(
          `Не удалось отправить заявку. ${err.message}. Убедитесь, что сервер запущен и CORS настроен.`,
          "error"
        );
      }
    });
  </script>
</body>
</html>
